@extends('layouts.app')

@php
use App\Application;
use App\User;
use App\Dept;


@endphp

@section('content')
<div class="container">
    <div class="row justify-content-center">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-wight-bold text-white font-size-5">休暇申請一覧</div>
                
                @if(session('flash_message'))
                    <div class="comfirm_message">
                        {{ session('flash_message') }}
                    </div>
                @endif

                <div class="card-body">

                    <div class="border border-dark rounded">
                        <h6 class="bg-primary text-white w-100 p-2">承認者( User {{ $user->id }} / Auth {{ Auth::id() }} ）</h6>
                        <div class="row m-1">
                            <div class="col-sm-3 m-1 bg-light align-middle">{{ $user->department->name }}</div>
                            <div class="col-sm-2 m-1 bg-light align-middle">{{ $user->grade }}</div>
                            <div class="col-sm-4 m-1 bg-light align-middle">{{ $user->name }}</div>
                        </div>
                    </div>

                    <div class="border border-dark rounded mt-3">
                        <h6 class="bg-primary text-white w-100 p-2">休暇申請一覧</h6>
                        <div class='m-1'>
                            
                        <div class="m-1 w-95">
                        {{ Form::open( [ 'url' => route( 'approval.index', [ 'user'    => $user ] ,
                                                                           [ 'class'   => 'form-control'] ) ] ) }}
                            @csrf
                            @method('GET')

                            <label>休暇日</label>
                            {{ Form::date( 'find[off_date]' ) }} 
                            
                            <label>ステータス</label>
                            {{ Form::select( 'find[status]', ['' => '', '承認待ち'=>'承認待ち', '承認'=>'承認', '却下' =>'却下' ],
                                                $find['status'] )  }}

                            <label>表示数</label>
                            {{ Form::select( 'find[pagination]',[5 => 5,10=>10, 15=>15], $find['pagination'], 
                                             [ 'class' => 'm-1', 'label' => '表示数' ] ) }}
                            {{ Form::submit( '検索', [ 'class' => 'm-1' ] ) }}
                        {{ Form::close() }}

                        
                        </div>
                        
                            
                        <div class="">
                            @php 
                                $statusClass = ['承認待ち'   => 'alert-primary font-weight-bold text-primary', 
                                                '却下'     => 'alert-danger font-weight-bold text-danger',
                                                '取り下げ' => 'alert-warning font-weight-bold',
                                                '休暇取得完了' => 'alert-success font-weight-bold' ];
                            @endphp
                        <table class='table table-border m-1 w-90'>
                            <tr class='table table-border'>
                                <th>詳細</th>
                                <th>申請者</th>
                                <th>休暇種別</th>
                                <th>申請日</th>
                                <th>休暇期間</th>
                                <th>休暇日数</th>
                                <th>ステータス</th>
                                <th>理由</th>
                            </tr>
                            @foreach( $approvals as $app )
                                @php
                                    $application = $app->application;
                                @endphp
                                <tr>
                                    <td><a class='btn btn-outline-primary' 
                                           href='{{ route( 'approval.approval', ['approval' => $app] ) }}'>
                                         {{ $application->id }}/{{ $app->id }}</a></td>
                                    <td>{{ $application->user->name }}({{ $application->user->id }})</td>
                                    <td>{{ $application->type }}</td>
                                    <td>{{ $application->date }}</td>
                                    <td><div data-toggle="tooltip" data-placement="top"
                                             title='{{ $application->start_date }}～{{ $application->end_date }}'>
                                        {{ $application->start_date }}～</div></td>
                                    <td>{{ $application->num        }}日</td>
                                    <td>{{ $app->status             }}</td>
                                    <td>{{ $application->reason     }}</td>

                                </tr>
                            @endforeach
                        </table>
                        {{ $approvals->links() }}
                        <script>
                            $('[data-toggle="tooltip"]').tooltip();
                        </script>
                        
                        </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
@php

@endphp 

@endsection

